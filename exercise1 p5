let rValue = 0;
let left = 0;
let right = 0;

let port;
let baudrate = 9600;

function setup() {
  createCanvas(640, 480);
  textSize(18);

  //create Serial Port object to communicate with Arduino
  port = createSerial();

  //automatically reconnect to the previous port 
  let usedPorts = usedSerialPorts();
  if (usedPorts.length > 0) {
    port.open(usedPorts[0], baudrate);
  }
}

// function to either connect or disconnect to Arduino
function setupSerial() {
  if (!port.opened()) {
    port.open("Arduino", baudrate);
  } else {
    port.close();
  }
}

function draw() {
  //control the background color based on the sensor value of light sensor 
  background(map(rValue, 0, 1023, 0, 255), 255, 255);

  if (!port.opened()) {
    text("Disconnected - press SPACE to connect", 20, 30);
  } else {
    text("Connected - press SPACE to disconnect", 20, 30);

    //read the data coming to the port until the newline character 
    let data = port.readUntil("\n");
    //if there is a data
    if (data.length > 0) {
      //convert the clean data into integer 
      rValue = int(trim(data));

      //store data of left and right into msg 
      let msg = left + "," + right + "\n";
      //send the msg back to the Arduino
      port.write(msg);
    }

    text("rValue = " + rValue, 20, 50);
  }

  //move xpos depending on the sensor value (max = 640)
  let xpos = map(rValue, 550, 900, 0, width);
  fill(0, 0, 255);
  ellipse(xpos, height / 2, 100, 50);

  //if mouse is pressed 
  if (mouseIsPressed) {
    //if the left side is clicked, set left to 1 
    if (mouseX <= width / 2) left = 1;
    //if the right side, set right to 1
    else right = 1;
  } else {
    left = 0;
    right = 0;
  }
}

function keyPressed() {
  if (key == " ") {
    setupSerial();
  }
}
