let port;
let baudrate = 9600;

let brightnessSlider;
let brightnessValue = 0;

function setup() {
  createCanvas(400, 400);
  textSize(18);

  //create the slider 
  brightnessSlider = createSlider(0, 255, 0);
  //set the position of the slider 
  brightnessSlider.position(30, height / 2);
  //set the slider's width to 200px 
  brightnessSlider.style('width', '200px');

  //create the serial port 
  port = createSerial();

  //automatically connect to the previous port 
  let usedPorts = usedSerialPorts();
  if (usedPorts.length > 0) {
    port.open(usedPorts[0], baudrate);
  }
}

function draw() {
  background(240);

  fill('red');
  text("Controlling LED Brightness with Slider!", 20, 40);
  text("Brightness: " + brightnessValue, 20, 140);

  //read the slider value 
  brightnessValue = brightnessSlider.value();

  //if the port is open
  if (port.opened()) {
    //store the brightness value from the slider 
    let msg = brightnessValue + "\n";
    //send it to Arduino
    port.write(msg);
  }

  //print the status of the port 
  if (!port.opened()) {
    fill(200, 0, 0);
    text("Disconnected - press SPACE to connect", 20, 20);
  } else {
    fill(0, 150, 0);
    text("Connected - press SPACE to disconnect", 20, 20);
  }
}

//press space to connect or disconnect 
function keyPressed() {
  if (key === " ") {
    if (!port.opened()) {
      port.open("Arduino", baudrate);
    } else {
      port.close();
    }
  }
}
